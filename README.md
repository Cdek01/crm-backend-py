# CRM API –Ω–∞ FastAPI
–≠—Ç–æ –±—ç–∫–µ–Ω–¥ –¥–ª—è –≥–∏–±–∫–æ–π, –º—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω–æ–π CRM-—Å–∏—Å—Ç–µ–º—ã, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –Ω–∞ FastAPI. –ö–ª—é—á–µ–≤—ã–º–∏ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç—è–º–∏ —è–≤–ª—è—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü, —Å–∏—Å—Ç–µ–º–∞ —Ä–æ–ª–µ–π –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π, –∞ —Ç–∞–∫–∂–µ —à–∏—Ä–æ–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏.
–ê–¥—Ä–µ—Å API: http://89.111.169.47:8005 <br>
–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: http://89.111.169.47:8005/docs <br>
–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: http://89.111.169.47:8005/admin
üöÄ –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏
–ú—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å: –ü–æ–ª–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (–∫–æ–º–ø–∞–Ω–∏–π).
–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä —Ç–∞–±–ª–∏—Ü: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã —Å —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏ (string, integer, float, date, time, boolean, select, email, phone, url).
–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–∞–≤ (RBAC): –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–æ–º —á–µ—Ä–µ–∑ —Ä–æ–ª–∏ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è, –≤–∫–ª—é—á–∞—è –¥–æ—Å—Ç—É–ø –∫ "—á—É–∂–∏–º" —Ç–∞–±–ª–∏—Ü–∞–º.
–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è: –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—ã –∏ –∫–æ–ª–æ–Ω–∫–∏ (–ø—Å–µ–≤–¥–æ–Ω–∏–º—ã).
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –ø–æ—Ä—è–¥–∫–∞ —Å—Ç—Ä–æ–∫ –∏ –∫–æ–ª–æ–Ω–æ–∫ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
–§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Celery –∏ Redis –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, SMS-—Ä–∞—Å—Å—ã–ª–æ–∫) –±–µ–∑ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ API.
–ü—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ (eq, gt, contains, blank, is_within –¥–ª—è –¥–∞—Ç –∏ —Ç.–¥.).
üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫
1. –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞
–î–ª—è –∑–∞–ø—É—Å–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ Windows, Linux –∏–ª–∏ MacOS.
1.1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è:
code
Bash
git clone <URL_–í–ê–®–ï–ì–û_–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
cd <–ü–ê–ü–ö–ê_–ü–†–û–ï–ö–¢–ê>
1.2. –°–æ–∑–¥–∞–Ω–∏–µ –∏ –∞–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
code
Bash
# –°–æ–∑–¥–∞–Ω–∏–µ
python -m venv venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Windows)
venv\Scripts\activate.bat

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Linux/MacOS)
source venv/bin/activate
1.3. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
code
Bash
pip install -r requirements.txt
1.4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ .env —Ñ–∞–π–ª–∞:
–°–∫–æ–ø–∏—Ä—É–π—Ç–µ .env.example –≤ .env –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (DATABASE_URL, SECRET_KEY –∏ —Ç.–¥.).
1.5. –ó–∞–ø—É—Å–∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤:
Redis (–¥–ª—è Celery):
code
Bash
docker run -d -p 6379:6379 redis
PostgreSQL (–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):
code
Bash
docker run -d -p 5432:5432 -e POSTGRES_PASSWORD=your_strong_password --name my-postgres postgres
1.6. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
–í–µ–±-—Å–µ—Ä–≤–µ—Ä FastAPI (–≤ –æ–¥–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
code
Bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
–í–æ—Ä–∫–µ—Ä Celery (–≤–æ –≤—Ç–æ—Ä–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ):
code
Bash
celery -A celery_worker.celery_app worker --loglevel=info

–¥–ª—è –≤–∏–Ω–¥—ã 
celery -A celery_worker.celery_app worker --loglevel=info --pool=solo
# 2. –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (Ubuntu)
2.1. –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–¥–∞:
code
Bash
cd /root/projects/crm-backend/crm-backend-py 
git pull origin main
2.2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–º (systemd):
code
Bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl start crm_api.service

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–∏—Å
sudo systemctl stop crm_api.service

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –∫–æ–¥–µ
sudo systemctl restart crm_api.service

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status crm_api.service

# –°–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
tail -f /var/log/crm_api.log      # –õ–æ–≥–∏ –¥–æ—Å—Ç—É–ø–∞
tail -f /var/log/crm_api_error.log # –õ–æ–≥–∏ –æ—à–∏–±–æ–∫
Datenbank (PostgreSQL)
–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
code
Bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è crm_user –∫ –±–∞–∑–µ crm_db
sudo -u postgres psql -d crm_db -U crm_user
–≤–∏–Ω–¥–∞ "C:\Program Files\PostgreSQL\16\bin\psql.exe" -h localhost -d crm_db -U crm_user

–°–∏—Å—Ç–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∏—Ç –ø–∞—Ä–æ–ª—å –¥–ª—è crm_user.
–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã psql
–ö–æ–º–∞–Ω–¥–∞	–û–ø–∏—Å–∞–Ω–∏–µ
\dt	–ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
\d users	–û–ø–∏—Å–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–∞–±–ª–∏—Ü—ã users
SELECT * FROM tenants;	–ü–æ–∫–∞–∑–∞—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã tenants
SELECT id, email FROM users;	–ü–æ–∫–∞–∑–∞—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –∏–∑ users
\q	–í—ã–π—Ç–∏ –∏–∑ psql



# –î–ª—è –º–∏–≥—Ä–∞—Ü–∏–∏ –±–¥

source venv_crm/bin/activate

"C:\Program Files\PostgreSQL\16\bin\psql.exe" -h localhost -d crm_db -U crm_user

alembic stamp head

alembic revision --autogenerate -m "Add multiselect support"
```    *   `revision`: –ö–æ–º–∞–Ω–¥–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π —Ä–µ–≤–∏–∑–∏–∏ (—Ñ–∞–π–ª–∞ –º–∏–≥—Ä–∞—Ü–∏–∏).
*   `--autogenerate`: –ì–æ–≤–æ—Ä–∏—Ç Alembic –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è.
*   `-m "..."`: –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π, —á—Ç–æ –¥–µ–ª–∞–µ—Ç —ç—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è.

alembic upgrade head

sudo systemctl restart crm_api.service